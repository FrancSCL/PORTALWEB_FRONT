# ğŸ“‹ **MENSAJE PARA EL BACKEND - FORMULARIO RENDIMIENTO PACKING**

## ğŸ¯ **SOLICITUD**

Hola equipo Backend,

Necesitamos implementar un formulario para el dato de **"Rendimiento Packing"** en la vista de Estimaciones. 
image.png
## ğŸ” **CONTEXTO ACTUAL**

### **Vista de Estimaciones:**
- **Panel izquierdo**: Lista de cuarteles con filtros
- **Panel derecho**: InformaciÃ³n detallada del cuartel seleccionado
  - InformaciÃ³n General âœ…
  - Estimaciones âœ…
  - Pautas âœ…
  - **Rendimiento Packing** â“ â† **NECESITAMOS FORMULARIO**

### **Pregunta especÃ­fica:**
Â¿CÃ³mo deberÃ­amos implementar el formulario para **Rendimiento Packing**?

## ğŸ“Š **INFORMACIÃ“N REQUERIDA**

### **1. Estructura de datos:**
- Â¿QuÃ© campos necesita el formulario de Rendimiento Packing?
- Â¿CuÃ¡les son los campos obligatorios vs opcionales?
- Â¿QuÃ© tipos de datos maneja (nÃºmeros, fechas, texto)?

### **2. Endpoints necesarios:**
- Â¿Existe endpoint para crear/actualizar rendimiento packing?
- Â¿QuÃ© endpoint usamos para obtener datos existentes?
- Â¿Necesitamos validaciones especiales?

### **3. Relaciones:**
- Â¿El rendimiento packing se relaciona con:
  - Cuartel especÃ­fico?
  - Temporada?
  - Usuario que lo registra?
  - Estimaciones existentes?

### **4. Reglas de negocio:**
- Â¿Hay restricciones de tiempo (ej: solo en ciertas fechas)?
- Â¿Hay lÃ­mites de valores (ej: porcentajes 0-100)?
- Â¿Se puede editar despuÃ©s de creado?

## ğŸ¨ **DISEÃ‘O SUGERIDO**

### **UbicaciÃ³n en la UI:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ARTIC FIRE B 1 A PC              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ï¸ InformaciÃ³n General              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Estimaciones                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Pautas                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¦ Rendimiento Packing              â”‚ â† NUEVA SECCIÃ“N
â”‚    [NUEVO RENDIMIENTO]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

### **Formulario propuesto:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ Nuevo Rendimiento Packing        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Fecha: [____/____/____]             â”‚
â”‚ Rendimiento: [____] %               â”‚
â”‚ Observaciones: [________________]    â”‚
â”‚                                     â”‚
â”‚ [Cancelar] [Guardar]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ **IMPLEMENTACIÃ“N FRONTEND**

### **Componente sugerido:**
```dart
class RendimientoPackingForm extends StatefulWidget {
  final int cuartelId;
  final Function(Map<String, dynamic>) onSaved;
  
  @override
  _RendimientoPackingFormState createState() => _RendimientoPackingFormState();
}

class _RendimientoPackingFormState extends State<RendimientoPackingForm> {
  final _formKey = GlobalKey<FormState>();
  final _fechaController = TextEditingController();
  final _rendimientoController = TextEditingController();
  final _observacionesController = TextEditingController();
  
  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: Text('Nuevo Rendimiento Packing'),
      content: Form(
        key: _formKey,
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            TextFormField(
              controller: _fechaController,
              decoration: InputDecoration(
                labelText: 'Fecha',
                hintText: 'DD/MM/YYYY',
              ),
              validator: (value) {
                if (value == null || value.isEmpty) {
                  return 'La fecha es obligatoria';
                }
                return null;
              },
            ),
            SizedBox(height: 16),
            TextFormField(
              controller: _rendimientoController,
              decoration: InputDecoration(
                labelText: 'Rendimiento (%)',
                hintText: '0-100',
              ),
              keyboardType: TextInputType.number,
              validator: (value) {
                if (value == null || value.isEmpty) {
                  return 'El rendimiento es obligatorio';
                }
                final rendimiento = double.tryParse(value);
                if (rendimiento == null || rendimiento < 0 || rendimiento > 100) {
                  return 'El rendimiento debe estar entre 0 y 100';
                }
                return null;
              },
            ),
            SizedBox(height: 16),
            TextFormField(
              controller: _observacionesController,
              decoration: InputDecoration(
                labelText: 'Observaciones',
                hintText: 'Comentarios adicionales (opcional)',
              ),
              maxLines: 3,
            ),
          ],
        ),
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.of(context).pop(),
          child: Text('Cancelar'),
        ),
        ElevatedButton(
          onPressed: _guardarRendimiento,
          child: Text('Guardar'),
        ),
      ],
    );
  }
  
  void _guardarRendimiento() async {
    if (_formKey.currentState!.validate()) {
      final datos = {
        'cuartel_id': widget.cuartelId,
        'fecha': _fechaController.text,
        'rendimiento': double.parse(_rendimientoController.text),
        'observaciones': _observacionesController.text,
      };
      
      // TODO: Llamar al endpoint del backend
      widget.onSaved(datos);
      Navigator.of(context).pop();
    }
  }
}
```

## ğŸ“¡ **ENDPOINTS NECESARIOS**

### **1. Crear Rendimiento Packing:**
```http
POST /api/rendimiento-packing
Authorization: Bearer {token}
Content-Type: application/json

{
  "cuartel_id": 1020200501,
  "fecha": "2025-01-25",
  "rendimiento": 85.5,
  "observaciones": "Rendimiento excelente en esta temporada"
}
```

### **2. Obtener Rendimientos por Cuartel:**
```http
GET /api/rendimiento-packing/cuartel/{cuartel_id}
Authorization: Bearer {token}
```

**Respuesta esperada:**
```json
{
  "success": true,
  "data": {
    "rendimientos": [
      {
        "id": "uuid-rendimiento-1",
        "cuartel_id": 1020200501,
        "fecha": "2025-01-25",
        "rendimiento": 85.5,
        "observaciones": "Rendimiento excelente",
        "usuario": "Francisco Soto",
        "fecha_registro": "2025-01-25T10:30:00Z"
      }
    ],
    "total": 1
  }
}
```

### **3. Actualizar Rendimiento:**
```http
PUT /api/rendimiento-packing/{rendimiento_id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "rendimiento": 87.0,
  "observaciones": "Rendimiento actualizado"
}
```

## ğŸ—„ï¸ **ESTRUCTURA DE BASE DE DATOS SUGERIDA**

### **Tabla: `rendimiento_packing`**
```sql
CREATE TABLE rendimiento_packing (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    cuartel_id BIGINT NOT NULL REFERENCES general_dim_cuartel(id),
    fecha DATE NOT NULL,
    rendimiento DECIMAL(5,2) NOT NULL CHECK (rendimiento >= 0 AND rendimiento <= 100),
    observaciones TEXT,
    usuario_id UUID NOT NULL REFERENCES usuarios(id),
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Ãndices para optimizar consultas
CREATE INDEX idx_rendimiento_packing_cuartel ON rendimiento_packing(cuartel_id);
CREATE INDEX idx_rendimiento_packing_fecha ON rendimiento_packing(fecha);
```

## ğŸ¯ **CASOS DE USO**

### **1. Crear nuevo rendimiento:**
- Usuario selecciona cuartel
- Hace clic en "NUEVO RENDIMIENTO"
- Completa formulario
- Guarda datos

### **2. Ver rendimientos existentes:**
- Lista de rendimientos por cuartel
- Ordenados por fecha (mÃ¡s reciente primero)
- Mostrar rendimiento, fecha, observaciones

### **3. Editar rendimiento:**
- Click en rendimiento existente
- Modificar datos
- Guardar cambios

## â“ **PREGUNTAS ESPECÃFICAS**

### **Para el Backend:**
1. **Â¿Existe ya la tabla de rendimiento packing?**
2. **Â¿QuÃ© campos son obligatorios?**
3. **Â¿Hay validaciones especiales?**
4. **Â¿Se relaciona con temporadas?**
5. **Â¿Hay restricciones de permisos?**

### **Para el Frontend:**
1. **Â¿DÃ³nde ubicamos el botÃ³n "NUEVO RENDIMIENTO"?**
2. **Â¿CÃ³mo mostramos la lista de rendimientos existentes?**
3. **Â¿Necesitamos filtros por fecha o rango?**
4. **Â¿Hay lÃ­mites de rendimientos por cuartel?**

## ğŸš€ **IMPLEMENTACIÃ“N SUGERIDA**

### **Fase 1: Backend**
1. Crear tabla de rendimiento packing
2. Implementar endpoints CRUD
3. Agregar validaciones
4. Documentar API

### **Fase 2: Frontend**
1. Crear componente de formulario
2. Integrar con endpoints
3. Agregar a vista de estimaciones
4. Implementar lista de rendimientos

### **Fase 3: Testing**
1. Probar creaciÃ³n de rendimientos
2. Verificar validaciones
3. Probar ediciÃ³n y eliminaciÃ³n
4. Validar permisos de usuario

## ğŸ“ **RESPUESTA ESPERADA**

Por favor, proporciona:

1. **Estructura de datos** exacta
2. **Endpoints disponibles** o necesarios
3. **Validaciones** requeridas
4. **Reglas de negocio** especÃ­ficas
5. **Ejemplo de respuesta** JSON

Con esta informaciÃ³n podremos implementar el formulario correctamente.

---

**ğŸ“… Fecha**: 25 de Enero 2025  
**ğŸ”§ Prioridad**: Media  
**ğŸ“‹ Estado**: Pendiente de respuesta backend

**Â¡Necesitamos la estructura de datos y endpoints para implementar el formulario de Rendimiento Packing!** ğŸ“¦
