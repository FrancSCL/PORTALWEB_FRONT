# üö® **ENDPOINTS FALTANTES PARA SISTEMA DE PAUTAS**

## üîß **PROBLEMA IDENTIFICADO**

Hola equipo Backend,

El frontend del **sistema de pautas** est√° fallando porque faltan varios endpoints esenciales. El error "Failed to fetch" indica que estos endpoints no existen en el servidor.

## üìã **ENDPOINTS FALTANTES**

### **üè∑Ô∏è ENDPOINTS B√ÅSICOS (4 endpoints):**
1. **`GET /api/temporadas`** - Listar temporadas disponibles
2. **`GET /api/cuarteles`** - Listar cuarteles del usuario
3. **`GET /api/atributos`** - Listar atributos disponibles
4. **`GET /api/especies`** - Listar especies disponibles

### **üìä ENDPOINTS DE PAUTAS (8 endpoints):**
5. **`GET /api/pautas/labor-especie`** - Listar combinaciones labor-especie
6. **`GET /api/pautas/atributos-especie/{especie_id}`** - Atributos por especie
7. **`GET /api/pautas/tipos-planta`** - Tipos de planta disponibles
8. **`GET /api/pautas/tipos-planta-registro`** - Tipos de planta desde registro de mapeo
9. **`GET /api/pautas/configuraciones`** - Listar configuraciones
10. **`POST /api/pautas/configuraciones`** - Crear configuraci√≥n
11. **`PUT /api/pautas/configuraciones/{id}`** - Actualizar configuraci√≥n
12. **`DELETE /api/pautas/configuraciones/{id}`** - Eliminar configuraci√≥n

### **üìù ENDPOINTS DE GESTI√ìN (6 endpoints):**
13. **`GET /api/pautas/pautas`** - Listar pautas del usuario
14. **`POST /api/pautas/pautas`** - Crear nueva pauta
15. **`GET /api/pautas/pautas/{id}`** - Obtener pauta espec√≠fica
16. **`GET /api/pautas/formulario/{labor_id}/{especie_id}`** - Generar formulario
17. **`POST /api/pautas/pautas/{id}/detalles`** - Crear detalle de pauta
18. **`POST /api/pautas/pautas/{id}/detalles-masivo`** - Crear m√∫ltiples detalles

---

## üéØ **ENDPOINTS PRIORITARIOS**

### **üî• CR√çTICOS (Para que funcione la pantalla):**
1. **`GET /api/temporadas`** - Para seleccionar temporada
2. **`GET /api/cuarteles`** - Para seleccionar cuartel
3. **`GET /api/pautas/labor-especie`** - Para generar formulario
4. **`GET /api/pautas/formulario/{labor_id}/{especie_id}`** - Para crear pauta

### **‚≠ê IMPORTANTES (Para funcionalidad completa):**
5. **`GET /api/atributos`** - Para configuraci√≥n
6. **`GET /api/pautas/configuraciones`** - Para gesti√≥n
7. **`POST /api/pautas/pautas`** - Para crear pauta
8. **`POST /api/pautas/pautas/{id}/detalles-masivo`** - Para guardar detalles

---

## üìä **ESTRUCTURA DE RESPUESTAS ESPERADAS**

### **1. Temporadas:**
```json
{
  "success": true,
  "message": "Temporadas obtenidas exitosamente",
  "data": {
    "temporadas": [
      {
        "id": 1,
        "nombre": "Temporada 2024-2025",
        "fecha_inicio": "2024-09-01",
        "fecha_fin": "2025-08-31",
        "activa": true
      }
    ],
    "total": 1
  }
}
```

### **2. Cuarteles:**
```json
{
  "success": true,
  "message": "Cuarteles obtenidos exitosamente",
  "data": {
    "cuarteles": [
      {
        "id": 1,
        "nombre": "Cuartel Norte",
        "descripcion": "Cuartel principal",
        "nombre_ceco": "CECO-001",
        "nombre_sucursal": "SAN MANUEL"
      }
    ],
    "total": 1
  }
}
```

### **3. Labor-Especie:**
```json
{
  "success": true,
  "message": "Labor-especie obtenidas exitosamente",
  "data": {
    "labor_especie": [
      {
        "id": 1,
        "id_labor": 1,
        "id_especie": 1,
        "nombre_labor": "Conteo",
        "nombre_especie": "CEREZA",
        "estado": 1
      }
    ],
    "total": 1
  }
}
```

### **4. Formulario Din√°mico:**
```json
{
  "success": true,
  "message": "Formulario generado exitosamente",
  "data": {
    "labor_especie": {
      "id": 1,
      "id_labor": 1,
      "id_especie": 1,
      "nombre_labor": "Conteo",
      "nombre_especie": "CEREZA"
    },
    "configuraciones": [
      {
        "id_atributo": 1,
        "nombre_atributo": "Peso",
        "id_tipoplanta": "TP001",
        "nombre_tipo_planta": "Planta Principal"
      }
    ],
    "tipos_planta": [
      {
        "id": "TP001",
        "nombre": "Planta Principal",
        "factor_productivo": 1.0,
        "descripcion": "Planta principal de producci√≥n"
      }
    ],
    "total_atributos": 1
  }
}
```

### **5. Crear Pauta:**
```json
{
  "success": true,
  "message": "Pauta creada exitosamente",
  "data": {
    "id": "PAU001",
    "id_conteotipo": "1",
    "id_usuario": "user123",
    "id_temporada": 1,
    "fecha": "2025-08-25",
    "hora_registro": "10:30:00",
    "id_cuartel": 1,
    "nombre_temporada": "Temporada 2024-2025",
    "nombre_cuartel": "Cuartel Norte",
    "nombre_labor": "Conteo",
    "nombre_especie": "CEREZA"
  }
}
```

### **6. Crear Detalles Masivos:**
```json
{
  "success": true,
  "message": "3 detalles creados exitosamente",
  "data": {
    "pauta": {
      "id": "PAU001",
      "nombre": "Pauta Conteo CEREZA"
    },
    "detalles_creados": [
      {
        "id": "DET001",
        "id_pauta": "PAU001",
        "id_atributo": 1,
        "id_tipoplanta": "TP001",
        "valor_atributo": 150.5,
        "nombre_atributo": "Peso",
        "nombre_tipo_planta": "Planta Principal"
      }
    ],
    "total_creados": 3
  }
}
```

---

## üîß **IMPLEMENTACI√ìN SUGERIDA**

### **Blueprint de Pautas:**
```python
# blueprints/pautas.py
from flask import Blueprint, request, jsonify
from models.pautas import *

pautas_bp = Blueprint('pautas', __name__)

@pautas_bp.route('/labor-especie', methods=['GET'])
def get_labor_especie():
    try:
        # Obtener labor-especie activas
        labor_especie = db.session.query(
            LaborEspecie.id,
            LaborEspecie.id_labor,
            LaborEspecie.id_especie,
            Labor.nombre.label('nombre_labor'),
            Especie.nombre.label('nombre_especie'),
            LaborEspecie.estado
        ).join(Labor, LaborEspecie.id_labor == Labor.id)\
         .join(Especie, LaborEspecie.id_especie == Especie.id)\
         .filter(LaborEspecie.estado == 1)\
         .all()
        
        return jsonify({
            "success": True,
            "message": "Labor-especie obtenidas exitosamente",
            "data": {
                "labor_especie": [{
                    "id": item.id,
                    "id_labor": item.id_labor,
                    "id_especie": item.id_especie,
                    "nombre_labor": item.nombre_labor,
                    "nombre_especie": item.nombre_especie,
                    "estado": item.estado
                } for item in labor_especie],
                "total": len(labor_especie)
            }
        })
    except Exception as e:
        return jsonify({
            "success": False,
            "message": f"Error al obtener labor-especie: {str(e)}"
        }), 500

@pautas_bp.route('/formulario/<int:labor_id>/<int:especie_id>', methods=['GET'])
def get_formulario(labor_id, especie_id):
    try:
        # Obtener configuraci√≥n de pauta para labor-especie
        configuraciones = db.session.query(
            ConfiguracionPauta.id_atributo,
            Atributo.nombre.label('nombre_atributo'),
            ConfiguracionPauta.id_tipoplanta,
            TipoPlanta.nombre.label('nombre_tipo_planta')
        ).join(Atributo, ConfiguracionPauta.id_atributo == Atributo.id)\
         .outerjoin(TipoPlanta, ConfiguracionPauta.id_tipoplanta == TipoPlanta.id)\
         .join(LaborEspecie, ConfiguracionPauta.id_conteotipo == LaborEspecie.id)\
         .filter(LaborEspecie.id_labor == labor_id)\
         .filter(LaborEspecie.id_especie == especie_id)\
         .all()
        
        # Obtener tipos de planta disponibles
        tipos_planta = db.session.query(TipoPlanta).all()
        
        return jsonify({
            "success": True,
            "message": "Formulario generado exitosamente",
            "data": {
                "labor_especie": {
                    "id": 1,
                    "id_labor": labor_id,
                    "id_especie": especie_id,
                    "nombre_labor": "Conteo",
                    "nombre_especie": "CEREZA"
                },
                "configuraciones": [{
                    "id_atributo": config.id_atributo,
                    "nombre_atributo": config.nombre_atributo,
                    "id_tipoplanta": config.id_tipoplanta,
                    "nombre_tipo_planta": config.nombre_tipo_planta
                } for config in configuraciones],
                "tipos_planta": [{
                    "id": tipo.id,
                    "nombre": tipo.nombre,
                    "factor_productivo": tipo.factor_productivo,
                    "descripcion": tipo.descripcion
                } for tipo in tipos_planta],
                "total_atributos": len(configuraciones)
            }
        })
    except Exception as e:
        return jsonify({
            "success": False,
            "message": f"Error al generar formulario: {str(e)}"
        }), 500

# ... m√°s endpoints
```

### **Registro en app.py:**
```python
# app.py
from blueprints.pautas import pautas_bp

app.register_blueprint(pautas_bp, url_prefix="/api/pautas")
```

---

## üöÄ **PRIORIDAD DE IMPLEMENTACI√ìN**

### **Fase 1 (Cr√≠tica) - IMPLEMENTAR PRIMERO:**
1. ‚úÖ **`GET /api/temporadas`** - Listar temporadas
2. ‚úÖ **`GET /api/cuarteles`** - Listar cuarteles del usuario
3. ‚úÖ **`GET /api/pautas/labor-especie`** - Listar labor-especie
4. ‚úÖ **`GET /api/pautas/formulario/{labor_id}/{especie_id}`** - Generar formulario

### **Fase 2 (Importante) - IMPLEMENTAR DESPU√âS:**
5. ‚úÖ **`POST /api/pautas/pautas`** - Crear pauta
6. ‚úÖ **`POST /api/pautas/pautas/{id}/detalles-masivo`** - Crear detalles
7. ‚úÖ **`GET /api/pautas/pautas`** - Listar pautas del usuario
8. ‚úÖ **`GET /api/pautas/pautas/{id}`** - Obtener pauta espec√≠fica

### **Fase 3 (Completa) - IMPLEMENTAR AL FINAL:**
9. ‚úÖ **`GET /api/pautas/configuraciones`** - Gesti√≥n de configuraciones
10. ‚úÖ **`POST /api/pautas/configuraciones`** - Crear configuraci√≥n
11. ‚úÖ **`PUT /api/pautas/configuraciones/{id}`** - Actualizar configuraci√≥n
12. ‚úÖ **`DELETE /api/pautas/configuraciones/{id}`** - Eliminar configuraci√≥n

---

## üìù **RESUMEN**

- ‚ùå **18 endpoints faltantes** para sistema de pautas
- üî• **4 endpoints cr√≠ticos** para funcionalidad b√°sica
- üìä **8 endpoints importantes** para funcionalidad completa
- üéØ **6 endpoints adicionales** para gesti√≥n avanzada

**El frontend est√° listo y esperando estos endpoints para funcionar completamente.**

**üìÖ Fecha**: 25 de Agosto 2025  
**üîß Versi√≥n**: 1.0.0  
**üìã Estado**: ‚ö†Ô∏è ENDPOINTS FALTANTES - REQUIERE IMPLEMENTACI√ìN BACKEND

---

## üéØ **ACCI√ìN INMEDIATA**

**Implementar al menos los 4 endpoints cr√≠ticos para que la pantalla de "Crear Pauta" funcione b√°sicamente:**

1. **`GET /api/temporadas`**
2. **`GET /api/cuarteles`** 
3. **`GET /api/pautas/labor-especie`**
4. **`GET /api/pautas/formulario/{labor_id}/{especie_id}`**

**Con estos 4 endpoints, el usuario podr√°:**
- ‚úÖ Seleccionar temporada y cuartel
- ‚úÖ Seleccionar labor-especie
- ‚úÖ Generar formulario din√°mico
- ‚úÖ Ver la interfaz funcionando

**Los dem√°s endpoints se pueden implementar gradualmente para funcionalidad completa.**

---

## üîç **ERROR ACTUAL**

**Frontend muestra:**
```
Error del sistema
Error al cargar los datos: ClientException: Failed to fetch, 
uri=https://api-portalweb-927498545444.us-central1.run.app/api/temporadas
```

**Esto indica que el endpoint `/api/temporadas` no existe en el servidor.**

**Una vez implementados los endpoints cr√≠ticos, el sistema de pautas funcionar√° completamente.**
